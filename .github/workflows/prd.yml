name: Standard

on:
  workflow_dispatch:
    inputs:
      target:
        description: 'Escolha qual servi√ßo rodar: web, api ou ambos'
        required: true
        default: 'both'
        type: choice
        options:
          - web
          - api
          - both

jobs:
  deploy-api-prd:
    if: inputs.target == 'api' || inputs.target == 'both'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install Backend Dependencies
        working-directory: ./packages/api
        run: npm install

      - name: Run Backend Tests
        working-directory: ./packages/api
        run: npm test

      - name: Deploy Backend to DEV
        working-directory: ./packages/api
        run: echo "Deploying Backend to PRD"

  deploy-web-prd:
    if: inputs.target == 'web' || inputs.target == 'both'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install Frontend Dependencies
        working-directory: ./packages/web/teste
        run: npm install

      - name: Build Frontend
        working-directory: ./packages/web/teste
        run: npm run build

      - name: Deploy Frontend to Production
        working-directory: ./packages/web/teste
        run: npx netlify-cli deploy --dir=build --site=55940732-ab52-4885-a761-45b35a37d4bb
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}